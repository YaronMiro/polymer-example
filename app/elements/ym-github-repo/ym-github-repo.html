<!-- import style  -->
<link rel="import" href="style/style.html">
<dom-module id="ym-github-repo">
  <!-- include the shared styles -->
  <style is="custom-style" include="style"></style>
  <template>
    <div class="github-repo-wrapper">
      <!-- Two-way binding for "<input>.value" -->
      <paper-input label="Owner" class="paper-font-body2" value="{{owner}}"></paper-input>
      <paper-input label="Name" class="paper-font-body2" value="{{name}}"></paper-input>
      <div class="paper-font-code1 url">{{url}}</div>
      <!-- Search button -->
      <p><paper-button gray-ripple raised on-click="_gettingRepositoryInfo">get repository info</paper-button></p>
      <div> <span hidden$="{{!error.text}}">{{error.text}}</span></div>
      <!-- Ajax call to Github API -->
      <iron-ajax
         id="ajax"
         url="{{url}}"
         handle-as="json"
         on-error="_onAjaxError"
         on-response="_onAjaxResponse"
         last-response="{{ajax.response}}">
       </iron-ajax>
      <section class="info-wrapper" hidden$="{{!error.status}}">
          <!-- Ajax response data render to markup -->
          <ul class="info">
            <li>
              <div>owner:</div>
              <a href="{{ajax.response.owner.url}}">{{ajax.response.owner.login}}</a>
            </li>
            <li class="image"><iron-image preload fade sizing="contain" src="{{ajax.response.owner.avatar_url}}"></iron-image></li>
            <li>
              <a href="{{ajax.response.html_url}}">{{ajax.response.name}}</a>
            </li>
            <li>Public repository</li>
            <li>Stars: <span>{{ajax.response.stargazers_count}}</span></li>
            <li></li>
          </ul>
      </section>
    </div>
  </template>
  <script>
    (function() {
      var ajaxService = {
        // Generating request to Github API.
        gettingRepositoryInfo: function() {
          this.$.ajax.generateRequest();
        },
        // Setting the request target url.
        settingRequestUrl: function(owner, name) {
          return 'https://api.github.com/repos/' + owner + '/' + name;
        },
        // Callback on successful request.
        onAjaxSucces: function() {
          this.set('error', {status: true});
        },
        // Callback on request error.
        onAjaxError: function() {
        this.set('error', {status: false, text: 'No matching repository was found'});
        }
      };

      Polymer({
        is: 'ym-github-repo',
        // Declaring init properties of the element.
        properties: {
          owner: {
            type: String,
            value: 'yaronMiro'
          },
          name: {
            type: String,
            value: 'AngularJS-UI-Router-Demo'
          },
          error: {
            type: Object,
            value: {
              text: '',
              status: false
            }
          },
          url: {
            type: String,
            computed: '_settingRequestUrl(owner, name)'
          },
          ajax: {
            type: Object,
            value: {
              response: {}
            }
          }
        },
        // Private element API.
        _settingRequestUrl: ajaxService.settingRequestUrl,
        _gettingRepositoryInfo: ajaxService.gettingRepositoryInfo,
        _onAjaxError: ajaxService.onAjaxError,
        _onAjaxResponse: ajaxService.onAjaxSucces
      });
    })();
  </script>

</dom-module>
