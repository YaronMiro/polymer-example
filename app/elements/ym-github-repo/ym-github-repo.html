<!-- import style  -->
<link rel="import" href="style/style.html">
<dom-module id="ym-github-repo">
  <!-- include the shared styles -->
  <style is="custom-style" include="style"></style>
  <template>
    <div class="github-repo-wrapper">
      <h3 class="paper-font-title">Github repository block</h3>
      <div class="paper-font-body1">Fill the fields to get an info about the repository (only for public repositories).</div>
      <paper-input label="Owner" class="paper-font-body2" value="{{owner}}"></paper-input>
      <paper-input label="Name" class="paper-font-body2" value="{{name}}"></paper-input>
      <code><span>{{url}}</span></code>
      <!-- Search button -->
      <div class="button-wrapper">
        <paper-button gray-ripple raised on-click="_generateRequest">get repository info</paper-button>
        <!-- Spinner icon -->
        <paper-spinner id="spinner" alt="Loading repository info"></paper-spinner>
      </div>
      <!-- Ajax error output -->
      <div> <span hidden$="{{!error.text}}">{{error.text}}</span></div>
      <!-- Ajax request -->
      <iron-ajax
         id="ajax"
         url="{{url}}"
         handle-as="json"
         on-error="_onAjaxError"
         on-response="_onAjaxResponse"
         last-response="{{ajax.response}}">
       </iron-ajax>
      <section class="info-wrapper" hidden$="{{!error.status}}">
          <!-- Ajax response data render to markup -->
          <ul class="info">
            <li>
              <div>owner:</div>
              <a href="{{ajax.response.owner.url}}">{{ajax.response.owner.login}}</a>
            </li>
            <li class="image">
              <iron-image id="preload3cfade"  preload fade sizing="contain" src="{{ajax.response.owner.avatar_url}}"></iron-image>
            </li>
            <li>
              <a href="{{ajax.response.html_url}}">{{ajax.response.name}}</a>
            </li>
            <li>Public repository</li>
            <li>Stars: <span>{{ajax.response.stargazers_count}}</span></li>
            <li></li>
          </ul>
      </section>
    </div>
  </template>
  <script>
    (function() {

      // Toggle the display of the spinner.
      function toggleSpinner() {
        var spinner = document.querySelector('paper-spinner');
        spinner.active = !spinner.active;
      };

      // Ajax request service.
      var ajaxService = {
        // Generating resst to Github API.
        generateRequest: function() {
          toggleSpinner();
          this.$.ajax.generateRequest();
        },
        // Setting the request target url.
        settingRequestUrl: function(owner, name) {
          return 'https://api.github.com/repos/' + owner + '/' + name;
        },
        // Callback on successful request.
        onAjaxSucces: function() {
          toggleSpinner();
          this.set('error', {status: true});
        },
        // Callback on request error.
        onAjaxError: function() {
          toggleSpinner();
          this.set('error', {status: false, text: 'No matching repository was found'});
        }
      };

      // Custom element declaration and behaviors.
      Polymer({
        is: 'ym-github-repo',
        // Declaring init properties of the element.
        properties: {
          owner: {
            type: String,
            value: 'yaronMiro'
          },
          name: {
            type: String,
            value: 'AngularJS-UI-Router-Demo'
          },
          error: {
            type: Object,
            value: {
              text: '',
              status: false
            }
          },
          url: {
            type: String,
            computed: '_settingRequestUrl(owner, name)'
          },
          ajax: {
            type: Object,
            value: {
              response: {}
            }
          }
        },
        // Private element API.
        _settingRequestUrl: ajaxService.settingRequestUrl,
        _generateRequest: ajaxService.generateRequest,
        _onAjaxError: ajaxService.onAjaxError,
        _onAjaxResponse: ajaxService.onAjaxSucces
      });
    })();
  </script>

</dom-module>
